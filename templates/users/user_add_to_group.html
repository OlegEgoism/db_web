<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—ã</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

<div class="container">
    <h1>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ username }} –≤ –≥—Ä—É–ø–ø—ã</h1>

    <div class="group-container">
        <!-- –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div>
            <h3>‚úÖ –£–∂–µ –µ—Å—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <ul class="group-list" id="user-groups" ondrop="drop(event, 'user-groups')" ondragover="allowDrop(event)">
                {% for group in user_groups %}
                    <li draggable="true" ondragstart="drag(event)" id="group_{{ group }}">{{ group }}</li>
                {% endfor %}
            </ul>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø, –∫–æ—Ç–æ—Ä—ã—Ö —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç -->
        <div>
            <h3>üîç –î–æ—Å—Ç—É–ø–Ω—ã–µ –≥—Ä—É–ø–ø—ã</h3>
            <ul class="group-list" id="available-groups" ondrop="drop(event, 'available-groups')" ondragover="allowDrop(event)">
                {% for group in available_groups %}
                    <li draggable="true" ondragstart="drag(event)" id="group_{{ group }}">{{ group }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø -->
    <form method="post" id="group-form">
        {% csrf_token %}
        <input type="hidden" name="username" value="{{ username }}">
        <input type="hidden" name="selected_groups" id="selected-groups">
        <input type="hidden" name="deleted_groups" id="deleted-groups">
        <button type="submit" class="submit-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã</button>
    </form>

    <div class="back-link">
        <a href="{% url 'user_list' %}">üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
    </div>
</div>

<script>
    let draggedElement = null;
    let deletedGroups = [];

    function allowDrop(event) {
        event.preventDefault();
    }

    function drag(event) {
        draggedElement = event.target;
    }

    function drop(event, targetId) {
        event.preventDefault();
        if (draggedElement) {
            const targetList = document.getElementById(targetId);
            const sourceList = draggedElement.parentNode;

            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã
            if (targetList !== sourceList) {
                targetList.appendChild(draggedElement);

                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã, –µ—Å–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–ª–∏ –≤ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
                if (sourceList.id === 'user-groups' && targetList.id === 'available-groups') {
                    deletedGroups.push(draggedElement.textContent);
                }
            }
            draggedElement = null;
        }
    }

    document.getElementById('group-form').addEventListener('submit', () => {
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –∏–∑ –ª–µ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞
        const selectedGroups = Array.from(document.getElementById('user-groups').children)
            .map(item => item.textContent);
        document.getElementById('selected-groups').value = selectedGroups.join(',');
        document.getElementById('deleted-groups').value = deletedGroups.join(',');
    });
</script>

</body>
</html>
