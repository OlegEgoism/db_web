{% extends 'base.html' %}
<title>{% block title %}–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ {{ db_name }}{% endblock %}</title>
{% block content %}
    <div class="welcome-container">
        <h2 class="welcome-title">–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: {{ db_name }} –¥–ª—è –≥—Ä—É–ø–ø—ã: {{ group_name }}</h2>
        <hr>
        <form method="post">
            {% csrf_token %}
            <div class="schema-layout">
                <div class="schema-list">
                    <h3>–°—Ö–µ–º—ã</h3>
                    <ul>
                        {% for schema in tables_by_schema.keys %}
                            <li>
                                <a href="javascript:void(0);" onclick="showSchemaTables('{{ schema }}')">
                                    üìÇ {{ schema }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="schema-content">
                    {% for schema, tables in tables_by_schema.items %}
                        <div class="schema-container" id="schema-{{ schema }}" style="display: none;">
                            <h3 class="schema-title">
                                {{ schema }}
                            </h3>
                            <table class="permissions-table">
                                <thead>
                                <tr>
                                    <th style="width: 240px">–¢–∞–±–ª–∏—Ü–∞</th>
                                    <th>
                                        <button type="button" class="btn btn-small" onclick="toggleSchemaPermissions('{{ schema }}', 'SELECT')">–í—Å–µ SELECT</button>
                                    </th>
                                    <th>
                                        <button type="button" class="btn btn-small" onclick="toggleSchemaPermissions('{{ schema }}', 'INSERT')">–í—Å–µ INSERT</button>
                                    </th>
                                    <th>
                                        <button type="button" class="btn btn-small" onclick="toggleSchemaPermissions('{{ schema }}', 'UPDATE')">–í—Å–µ UPDATE</button>
                                    </th>
                                    <th>
                                        <button type="button" class="btn btn-small" onclick="toggleSchemaPermissions('{{ schema }}', 'DELETE')">–í—Å–µ DELETE</button>
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for table, permissions in tables.items %}
                                    <tr>
                                        <td>{{ table }}</td>
                                        <td><input type="checkbox" class="permission-checkbox {{ schema }}-SELECT" name="permissions_{{ schema }}.{{ table }}" value="SELECT"
                                                   {% if "SELECT" in permissions %}checked{% endif %}></td>
                                        <td><input type="checkbox" class="permission-checkbox {{ schema }}-INSERT" name="permissions_{{ schema }}.{{ table }}" value="INSERT"
                                                   {% if "INSERT" in permissions %}checked{% endif %}></td>
                                        <td><input type="checkbox" class="permission-checkbox {{ schema }}-UPDATE" name="permissions_{{ schema }}.{{ table }}" value="UPDATE"
                                                   {% if "UPDATE" in permissions %}checked{% endif %}></td>
                                        <td><input type="checkbox" class="permission-checkbox {{ schema }}-DELETE" name="permissions_{{ schema }}.{{ table }}" value="DELETE"
                                                   {% if "DELETE" in permissions %}checked{% endif %}></td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% empty %}
                        <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ö–µ–º –∏ —Ç–∞–±–ª–∏—Ü.</p>
                    {% endfor %}
                </div>
            </div>
            <div class="all-btn">
                <a href="{% url 'groups_edit_privileges' group_name %}" class="btn btn-cancel">–ù–∞–∑–∞–¥</a>
                <button type="submit" class="btn btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>

    <script>
        function showSchemaTables(schema) {
            document.querySelectorAll(".schema-container").forEach(el => el.style.display = "none");
            document.getElementById("schema-" + schema).style.display = "block";
        }

        function toggleSchemaPermissions(schema, permissionType) {
            let checkboxes = document.querySelectorAll("." + schema + "-" + permissionType);
            let allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            checkboxes.forEach(checkbox => checkbox.checked = !allChecked);
        }
    </script>

    <style>
        .schema-layout {
            display: flex;
        }

        .schema-list {
            width: 20%;
            background: #f4f4f4;
            padding: 15px;
            border-right: 1px solid #ccc;
        }

        .schema-list ul {
            list-style: none;
            padding: 0;
        }

        .schema-list li {
            padding: 5px 0;
        }

        .schema-list a {
            text-decoration: none;
            color: #007bff;
            font-weight: bold;
            cursor: pointer;
        }

        .schema-list a:hover {
            text-decoration: underline;
        }

        /* ‚úÖ –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ */
        .schema-content {
            width: 80%;
            padding: 15px;
        }

        .permissions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
        }

        .permissions-table th, .permissions-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .permissions-table th {
            background-color: #e0e0e0;
        }

        .permissions-table th button {
            width: 100%;
            font-size: 12px;
            padding: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
        }

        .permissions-table th button:hover {
            background-color: #0056b3;
        }
    </style>
{% endblock %}
