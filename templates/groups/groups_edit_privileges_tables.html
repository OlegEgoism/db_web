{% extends 'base.html' %}
<title>{% block title %}–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ {{ db_name }}{% endblock %}</title>
{% block content %}
    <div class="welcome-container">
        <h2 class="welcome-title">–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: {{ db_name }} –¥–ª—è –≥—Ä—É–ø–ø—ã: {{ group_name }}</h2>
        <hr>

        <form method="post">
            {% csrf_token %}

            <div class="select-all">
                <label>
                    <input type="checkbox" id="selectAll" onclick="toggleAllPermissions()"> –í—ã–±—Ä–∞—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∞
                </label>
            </div>

            <ul class="tree">
                {% for schema, tables in tables_by_schema.items %}
                    <li>
                        <span class="tree-node" onclick="toggleTree('{{ schema }}')">üìÅ {{ schema }}</span>
                        <ul id="tree-{{ schema }}" style="display: none;">
                            {% for table, permissions in tables.items %}
                                <li>
                                    üìÑ {{ table }}
                                    <label><input type="checkbox" class="permission-checkbox" name="permissions_{{ schema }}.{{ table }}" value="SELECT"
                                                  {% if "SELECT" in permissions %}checked{% endif %}> SELECT</label>
                                    <label><input type="checkbox" class="permission-checkbox" name="permissions_{{ schema }}.{{ table }}" value="INSERT"
                                                  {% if "INSERT" in permissions %}checked{% endif %}> INSERT</label>
                                    <label><input type="checkbox" class="permission-checkbox" name="permissions_{{ schema }}.{{ table }}" value="UPDATE"
                                                  {% if "UPDATE" in permissions %}checked{% endif %}> UPDATE</label>
                                    <label><input type="checkbox" class="permission-checkbox" name="permissions_{{ schema }}.{{ table }}" value="DELETE"
                                                  {% if "DELETE" in permissions %}checked{% endif %}> DELETE</label>
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% empty %}
                    <li>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü</li>
                {% endfor %}
            </ul>

            <div class="all-btn">
                <a href="{% url 'groups_edit_privileges' group_name %}" class="btn btn-cancel">–ù–∞–∑–∞–¥</a>
                <button type="submit" class="btn btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>

    <script>
        function toggleTree(schema) {
            let element = document.getElementById("tree-" + schema);
            element.style.display = (element.style.display === "none") ? "block" : "none";
        }

        function toggleAllPermissions() {
            let checkboxes = document.querySelectorAll(".permission-checkbox");
            let selectAll = document.getElementById("selectAll");
            checkboxes.forEach(checkbox => checkbox.checked = selectAll.checked);
        }
    </script>

    <style>
        .tree { list-style-type: none; padding-left: 20px; }
        .tree li { margin: 5px 0; cursor: pointer; }
        .tree ul { padding-left: 20px; display: none; }
        .tree-node { font-weight: bold; cursor: pointer; }
    </style>
{% endblock %}
